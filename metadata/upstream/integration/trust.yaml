ssh_key_filename: ~/.ssh/id_rsa
admin_id: admin
admin_pw: Secret123
dirman_id: '"cn=Directory Manager"'
dirman_pw: Secret123
dns_forwarder: 10.11.5.19
domains:
  - name: testrelm.test
    type: IPA
    hosts:
      - name: runner.testrelm.test
        group: runner
        role: test
        os: rhel-8.4
      - name: master.testrelm.test
        group: ipaserver
        role: master
        os: rhel-8.4
      - name: client.testrelm.test
        group: ipaclient
        role: client
        os: rhel-8.4
  - name: ad.test
    type: AD
    hosts:
      - name: root-dc.ad.test
        role: ad
        group: ad_root
        os: win-2016
        network: IPv4
  - name: child.ad.test
    type: AD_SUBDOMAIN
    parent: ad.test
    hosts:
      - name: child-dc.child.ad.test
        role: ad_subdomain
        group: ad_subdomain
        os: win-2016
        network: IPv4
  - name: adtree.test
    type: AD_TREEDOMAIN
    parent: ad.test
    hosts:
      - name: tree-dc.adtree.test
        role: ad_treedomain
        group: ad_treedomain
        os: win-2016
        network: IPv4
phases:
  - name: init
    steps:
      - playbook: init/testrunner-dir.yaml
  - name: provision
    steps:
      - playbook: provision/linchpin-up.yaml
      - playbook: provision/win-config.yaml
      - playbook: provision/wait.yaml
  - name: prep
    steps:
      - playbook: prep/redhat-base.yaml
      - playbook: prep/repos.yaml
      - playbook: prep/ipa-network-hosts.yaml
      - playbook: prep/install-ipa-packages.yaml
      - playbook: prep/prepare-upstream.yaml
      - playbook: prep/firewall.yaml
      - command: yum install -y samba-client
        host: master.testrelm.test
      - playbook: prep/win-domain-setup.yaml
        extra_vars:
          upn_suffixes:
            - UPNsuffix.com
      - playbook: prep/win-user-add.yaml
        extra_vars:
          target_host: root-dc.ad.test
          users:
            # A test user with posix attributes defined
            - name: testuser
              password: Secret123
              attributes:
                uidNumber: 10042
                gidNumber: 10047
                loginShell: /bin/sh
                homeDirectory: /home/testuser
                unixHomeDirectory: /home/testuser
                gecos: Test User
            # A test user without posix attributes defined
            - name: nonposixuser
              password: Secret123
            # A user with UPN suffix
            - name: upnuser
              password: Secret123456
              upn: upnuser@UPNsuffix.com
              attributes:
                uidNumber: 10048
                gidNumber: 10047
                loginShell: /bin/sh
                gecos: UPN User
      - playbook: prep/win-user-add.yaml
        extra_vars:
          target_host: child-dc.child.ad.test
          users:
            # A test user with posix attributes defined
            - name: subdomaintestuser
              password: Secret123
              attributes:
                uidNumber: 10142
                gidNumber: 10147
                loginShell: /bin/sh
                gecos: Subdomaintest User
      - playbook: prep/win-user-add.yaml
        extra_vars:
          target_host: tree-dc.adtree.test
          users:
            # A test user with posix attributes defined
            - name: treetestuser
              password: Secret123456
              attributes:
                uidNumber: 10242
                gidNumber: 10247
                loginShell: /bin/sh
                gecos: TreeTest User
      - playbook: prep/win-group-add.yaml
        extra_vars:
          target_host: root-dc.ad.test
          ad_groups:
            - name: testgroup
              gidNumber: 10047
              scope: global
              members: ['testuser']
      - playbook: prep/win-primary-group.yaml
        extra_vars:
          target_host: root-dc.ad.test
          ad_groups:
            - name: testgroup
              members: ['testuser']
      - playbook: prep/config-abrt.yaml
  - name: test
    steps:
      - playbook: test/test-upstream.yaml
        extra_vars:
          test_suite: test_integration/test_trust.py
  - name: teardown
    steps:
      - playbook: teardown/fetch-logs.yaml
      - playbook: teardown/linchpin-destroy.yaml
