ssh_key_filename: ~/.ssh/id_rsa
admin_id: admin
admin_pw: Secret123
dirman_id: '"cn=Directory Manager"'
dirman_pw: Secret123
dns_forwarder: 10.11.5.19
domains:
  - name: testrelm.test
    type: IPA
    hosts:
      - name: master.testrelm.test
        group: ipaserver
        role: master
        os: rhel-8.3
  - name: win.test
    type: ad
    hosts:
      - name: ad.win.test
        role: ad
        group: ad_root
        os: win-2016

phases:
  - name: init
    steps:
      - playbook: init/testrunner-dir.yaml
  - name: provision
    steps:
      - playbook: provision/linchpin-up.yaml
      - playbook: provision/win-config.yaml
      - playbook: provision/wait.yaml
  - name: prep
    steps:
      - playbook: prep/redhat-base.yaml
      - playbook: prep/repos.yaml
      - playbook: prep/ipa-network-hosts.yaml
      - playbook: prep/install-ipa-packages.yaml
      - playbook: prep/prepare-upstream.yaml
      - playbook: prep/firewall.yaml
      - playbook: prep/prepare-xmlrpc.yaml
      - playbook: prep/win-domain-setup.yaml
      - playbook: prep/ipa-adtrust-install.yaml
      - command: echo Secret123 | ipa trust-add --type ad --admin Administrator --password win.test
        host: master.testrelm.test

      - playbook: prep/config-abrt.yaml
  - name: test
    steps:
      - playbook: test/test-xmlrpc.yaml
        extra_vars:
          test_suite:
              test_xmlrpc/test_trust_plugin.py
              test_xmlrpc/test_external_members.py
  - name: teardown
    steps:
      - playbook: teardown/fetch-logs.yaml
      - playbook: teardown/linchpin-destroy.yaml
