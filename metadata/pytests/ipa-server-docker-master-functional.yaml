domains:
  - name: testrealm.test
    type: ipa
    hosts:
      - name: master.testrealm.test
        role: master
        group: ipaserver
        os: rhel-7.5-atomic # replace with e.g. rhel-7.6 for non-atomic
phases:
  - name: init
    steps:
      - playbook: init/pytests.yaml
        type: controller
        extra_vars:
          repo: https://gitlab.cee.redhat.com/pvoborni/ipa-pytests.git
          version: rename
      - playbook: init/testrunner-dir.yaml
        type: controller
  - name: provision
    steps:
      - playbook: provision/linchpin-up.yaml
        type: controller
      - playbook: provision/wait.yaml
        type: sut
  - name: prep
    steps:
      # For Atomic host
      - playbook: prep/root-ssh.yaml
        type: sut
      # Uncommenting the below will enable this test to run on non-atomic RHEL 7
      # - playbook: prep/redhat-base.yaml
      #   type: sut
      # - playbook: prep/install-docker.yaml
      #   type: sut
  - name: test
    steps:
      # Run only subset of test. Removing the /test_ipa... part will run all
      # docker tests there
      - pytests: src/ipa_server_docker/test_ipa_server_docker_master_Functional.py
        git: ../ipa-pytests

  - name: teardown
    steps:
      - playbook: teardown/linchpin-destroy.yaml
        type: controller
