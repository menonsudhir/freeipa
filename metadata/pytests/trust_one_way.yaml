domains:
  - name: testrealm1way.test
    type: ipa
    hosts:
      - name: master.testrealm1way.test
        role: master
        group: ipaserver
        os: rhel-8.3
  - name: win2016.test
    type: ad
    hosts:
      - name: ad1.win2016.test
        role: ad
        group: ad_root
        os: win-2016
        netbios: WIN2016
        domain_level: top
        network: IPv4
  - name: sub1.win2016.test
    type: ad
    parent: win2016.test
    hosts:
      - name: ad2.sub1.win2016.test
        role: ad
        group: ad_subdomain
        os: win-2016
        netbios: SUB1
        domain_level: sub1
        network: IPv4
phases:
  - name: init
    steps:
      - playbook: init/ipa-pytests.yaml
        extra_vars:
          repo: https://gitlab.cee.redhat.com/identity-management/ipa-pytests.git
          version: RHEL8.3
      - playbook: init/testrunner-dir.yaml
  - name: provision
    steps:
      - playbook: provision/linchpin-up.yaml
      - playbook: provision/win-config.yaml
      - playbook: provision/wait.yaml
  - name: prep
    steps:
      - playbook: prep/redhat-base.yaml
      - playbook: prep/repos.yaml
      - playbook: prep/install-ipa-packages.yaml
      - playbook: prep/prepare-pytest.yaml
      - playbook: prep/firewall.yaml
      - playbook: prep/ipa-network.yaml
      - playbook: prep/win-domain-setup.yaml
      - playbook: prep/win-user-add.yaml
        extra_vars:
          users:
            - name: aduser1
              password: Secret123
          target_host: ad1.win2016.test
      - playbook: prep/win-user-add.yaml
        extra_vars:
          users:
            - name: aduser1
              password: Secret123
          target_host: ad2.sub1.win2016.test
  - name: test
    steps:
      - pytests: src/trust_one_way
        git: ../ipa-pytests

  - name: teardown
    steps:
      - playbook: teardown/fetch-logs.yaml
      - playbook: teardown/linchpin-destroy.yaml
