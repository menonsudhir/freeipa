domains:
  - name: testrealm.test
    type: ipa
    hosts:
      - name: master.testrealm.test
        external_hostname: hostname1
        role: master
        group: ipaserver
        os: rhel-8.1
  - name: ipaad2012r2.test
    type: ad
    hosts:
      - name: idm-qe-ipa-win3.ipaad2012r2.test
        external_hostname: idm-qe-ipa-win3.ipaad2012r2.test
        ip: 10.8.63.43
        role: ad
        username: 'Administrator'
        password: 'Secret123'
        host_type: 'windows'
phases:
  - name: init
    steps:
      - playbook: init/pytests.yaml
        type: controller
      - playbook: init/testrunner-dir.yaml
        type: controller
  - name: provision
    steps:
      - playbook: provision/linchpin-up.yaml
        type: controller
      - playbook: provision/wait.yaml
        type: sut
  - name: prep
    steps:
      - playbook: prep/redhat-base.yaml
        type: sut
      - playbook: prep/repos.yaml
        type: sut
      - playbook: prep/install-ipa-packages.yaml
        type: sut
      - playbook: prep/prepare-pytest.yaml
        type: sut
      - playbook: prep/firewall.yaml
        type: sut
      - playbook: prep/ipa-network.yaml
        type: sut
  - name: test
    steps:
      - pytests: src/ipa-winsync-migrate
        git: ../ipa-pytests

  - name: teardown
    steps:
      - playbook: teardown/linchpin-destroy.yaml
        type: controller
