domains:
  - name: upgrade.test
    type: IPA
    hosts:
      - name: master.upgrade.test
        role: master
        group: ipaserver
        os: rhel-8.0
        restraint_id: 1
      - name: replica.upgrade.test
        role: replica
        group: ipaserver
        os: rhel-8.0
        restraint_id: 2
      - name: client.upgrade.test
        role: client
        group: ipaclient
        os: rhel-8.0
        restraint_id: 3
phases:
  - name: init
    steps:
      - playbook: init/ipatests.yaml
        type: controller
      - playbook: init/testrunner-dir.yaml
        type: controller
  - name: provision
    steps:
      - playbook: provision/linchpin-up.yaml
        type: controller
      - playbook: provision/wait.yaml
        type: sut
  - name: prep
    steps:
      - playbook: prep/redhat-base.yaml
        type: sut
      - playbook: prep/repos.yaml
        type: sut
      - playbook: prep/restraint.yaml
        type: sut
  - name: test
    steps:
      - restraint: beaker/ipa-server/acceptance/ipa-upgrade/restraint.xml
        git: ../ipa-tests
        stop-on-error: 'False'
      - playbook: test/restraint-results.yaml
        type: controller
  - name: teardown
    steps:
      - playbook: teardown/linchpin-destroy.yaml
        type: controller
